<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>基因概率计算器</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        .container {
            max-width: 600px;
            margin: 0 auto;
        }
        input, button {
            padding: 10px;
            margin: 5px 0;
            width: 100%;
        }
        .button-group {
            display: flex;
            justify-content: space-between;
            margin: 10px 0;
        }
        .button-group button {
            flex: 1;
            margin: 0 5px;
            padding: 10px;
            cursor: pointer;
            border: 1px solid #ddd;
            background-color: #f4f4f4;
        }
        .button-group button.selected {
            background-color: #007bff;
            color: white;
            border-color: #0056b3;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        table, th, td {
            border: 1px solid #ddd;
        }
        th, td {
            padding: 10px;
            text-align: center;
        }
        th {
            background-color: #f4f4f4;
        }
    </style>
</head>
<body>
<div class="container">
    <h1>基因概率计算器</h1>
    <p>计算父本为 <strong>AA</strong>，母本为 <strong>aa</strong> 的后代自交 <strong>n</strong> 代后的基因型概率。</p>
    <label for="generations">输入代数 (n):</label>
    <input type="number" id="generations" min="1" placeholder="请输入代数">

    <div class="button-group">
        <button id="none" class="selected" onclick="setRemoveType('none', this)">不去除</button>
        <button id="aa" onclick="setRemoveType('aa', this)">去除 aa</button>
        <button id="Aa" onclick="setRemoveType('Aa', this)">去除 Aa</button>
        <button id="AA" onclick="setRemoveType('AA', this)">去除 AA</button>
    </div>

    <button onclick="calculate()">计算</button>
    <table id="resultTable" style="display: none;">
        <thead>
        <tr>
            <th>代数 (n)</th>
            <th>AA 概率</th>
            <th>Aa 概率</th>
            <th>aa 概率</th>
        </tr>
        </thead>
        <tbody id="resultBody"></tbody>
    </table>
</div>

<script>
    let removeType = 'none';
    let selectedButton = document.getElementById('none'); // 默认选中 "不去除"

    function setRemoveType(type, button) {
        removeType = type;

        // 更新按钮选中状态
        if (selectedButton) {
            selectedButton.classList.remove('selected');
        }
        button.classList.add('selected');
        selectedButton = button;
    }

    function calculate() {
        const generations = parseInt(document.getElementById("generations").value);

        if (isNaN(generations) || generations < 1) {
            alert("请输入有效的代数 (n >= 1)");
            return;
        }

        // 初始比例
        let pAA = 0; // AA 概率
        let pAa = 1; // Aa 概率
        let paa = 0; // aa 概率

        const resultBody = document.getElementById("resultBody");
        resultBody.innerHTML = ""; // 清空表格内容

        for (let n = 1; n <= generations; n++) {
            // 计算下一代的未归一化比例
            let nextAA = pAA + 0.25 * pAa;
            let nextAa = 0.5 * pAa;
            let nextaa = 0.25 * pAa + paa;
            let nextRemoved = nextAA + nextAa + nextaa;

            // 根据选择去除基因型
            if (removeType === "aa") {
                nextRemoved = nextAA + nextAa;
                nextaa = 0;
            } else if (removeType === "Aa") {
                nextRemoved = nextAA + nextaa;
                nextAa = 0;
            } else if (removeType === "AA") {
                nextRemoved = nextAa + nextaa;
                nextAA = 0;
            }

            // 归一化
            pAA = nextAA / nextRemoved;
            pAa = nextAa / nextRemoved;
            paa = nextaa / nextRemoved;

            // 添加到表格
            const row = document.createElement("tr");
            row.innerHTML = `
                <td>${n}</td>
                <td>${pAA.toFixed(4)}</td>
                <td>${pAa.toFixed(4)}</td>
                <td>${paa.toFixed(4)}</td>
            `;
            resultBody.appendChild(row);
        }

        // 显示结果表格
        document.getElementById("resultTable").style.display = "table";
    }
</script>
</body>
</html>